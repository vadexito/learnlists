<?php

$title = $this->translate('Learn at LearnLists');
$this->headTitle($title);
$this->placeholder('header')->captureStart();
$searchForm->setAttribute('action', $this->url('lrnl-search'));
$searchForm->prepare();

//initiate searchForm filters select element (chosen plugin)
$urlQueries = $filterForm->get('filters')->getAttribute('data-urls');
$urls = [];
foreach ($urlQueries as $urlquery){
    $urls[] = $this->url('lrnl-search',[],['query' => $urlquery->toArray()]);
}

$filterForm->get('filters')->setAttribute('data-urls',\Zend\Json\Json::encode($urls));
$paginationControl = $this->paginationControl(
    $this->lists,
    'Sliding',
    'pagination_control',
    ['route' => 'lrnl-search','query' => $query]
);
?>

<div class="row-fluid search_bar_top">
    <div class="span12">
        <div class="row-fluid  well well-small">
            <?php echo $this->formTwb()->openTag($searchForm);?>
            <?php foreach ($searchForm as $element) : if ($element->getName() != 'submit') : ?>
            <?php echo $this->formRowTwb($element, \DluTwBootstrap\Form\FormUtil::FORM_TYPE_INLINE);?>
            <?php endif; endforeach; ?>
            <button type="submit" class="btn btn-large btn-primary">
                <i class="icon-white icon-search"></i> <?php echo $this->translate('Search'); ?>
            </button>
            <?php echo $this->formTwb()->closeTag($searchForm);?> 
        </div>
    </div>
</div>
<div class="row-fluid search_engine">
    <div class="span3">
        <div class="span11 well" id="left_side_filters">
            <?php foreach ($filterForm->getFieldsets() as $filter):  ?>
            <?php if ($filter->getAttribute('data-filterType') === 'checkbox'): ?>
            <div class="filter-search filter-search-term">
                <a type="button" data-toggle="collapse" data-target="#<?php $name = 'collapse'.$filter->getName();echo $name; ?>">
                    <h5 class="well"><?php echo ucfirst($this->translate($filter->getLabel())); ?></h5>
                </a>
                <div class="collapse in filter-choice" id="<?php echo $name; ?>">
                    <div class="well">
            <?php foreach ($filter->getElements() as $checkbox): 
                $checkbox->setAttribute('data-url',$this->url('lrnl-search',[],['query' => $checkbox->getQueryUrl()]));
                ?>
                        <label class="checkbox">
                            <?php echo $this->formCheckbox($checkbox); ?> <?php echo $checkbox->getLabel(); ?>
                            <span class="badge pull-right"><?php echo $checkbox->getAttribute('data-hitNb'); ?></span>
                        </label>
            <?php endforeach; ?>
                    </div>
                </div>
            </div>
            <?php endif;?>
            <?php if ($filter->getAttribute('data-filterType')==='range'): ?>
            <?php foreach ($filter->getElements() as $range): 
                $range->setAttribute('data-url',$this->url('lrnl-search',[],['query' => $range->getQueryUrl()]));
            ?>
            <div class="filter-search filter-search-range">
                <a type="button" data-toggle="collapse" data-target="#<?php $name = 'collapse'.$range->getName();echo $name; ?>">
                     <h5 class="well"><?php echo ucfirst($this->translate($range->getLabel())); ?></h5>
                </a>               
                <div class="collapse in filter-choice" id="<?php echo $name; ?>">
                    <div class="well">
                        <span class="min-slider label label-important pull-left"></span>
                        <span class="max-slider label label-important pull-right"></span>
                        <?php echo $this->formInput($range); ?>  
                    </div>
                </div>
            </div>
            <?php endforeach; ?>
            <?php endif;?>
            <?php if ($filter->getAttribute('data-filterType')==='search'): ?>
            <?php foreach ($filter->getElements() as $search): 
                $search->setAttribute('data-url',$this->url('lrnl-search',[],['query' => $search->getQueryUrl()]));            
            ?>
            <div class="filter-search filter-search-search">
                <a type="button" data-toggle="collapse" data-target="#<?php $name = 'collapse'.$search->getName();echo $name; ?>">
                    <h5 class="well"><?php echo $search->getLabel(); ?></h5>
                </a>
                <div class="collapse in filter-choice" id="<?php echo $name; ?>">
                    <div class="well input-append">
                        <?php echo $this->formInput($search); ?>
                        <button class="btn btn-primary">
                            <i class="icon icon-white icon-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <?php endforeach; ?>
            <?php endif;?>
            <?php endforeach; ?>
        </div>
    </div>
    <div class="span9" id="search_results_body">
        <div class="row-fluid  well well-small" id="search_result_summary">
            <?php echo sprintf($this->translate('%s results'),$resultNb); ?>                      
        </div>
        <div class="row-fluid">
            <?php echo $this->formRow($filterForm->get('filters')); ?>              
        </div>
        <hr>
        <div class="row-fluid">
            <div class="row-fluid">
               <ul id="search_result_lists">
                    <?php echo $this->listquestCollection($lists); ?>               
                </ul> 
            </div>
            <div class="row-fluid">
                <div class="span6">
                    <button id="comment-button" type="button" class="btn" data-toggle="collapse" data-target="#comment">
                        <i class="icon-comment"></i> <?php echo $this->translate('Leave a comment!') ?>
                    </button>
                </div>
                <div class="span6">
                    <?php echo $paginationControl ?>
                </div>
            </div>
            <div class="row-fluid">
                <div id="comment" class="collapse">
                <?php echo $this->disqus(); ?>
                </div>
            </div>
        </div>
    </div>
</div>
        