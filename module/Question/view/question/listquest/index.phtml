<?php

$title = $this->translate('Learn at LearnLists');
$this->headTitle($title);
$this->placeholder('header')->captureStart();
$this->headLink()->prependStylesheet($this->basePath() . '/js/jquery.tablesorter.pager.css');
$this->headScript()->appendFile($this->basePath() . '/js/jquery-infinitescroll.js');
$this->headScript()->appendFile($this->basePath() . '/js/jquery.metadata.js');
$this->headScript()->appendFile($this->basePath() . '/js/jquery.tablesorter.min.js');
$this->headScript()->appendFile($this->basePath() . '/js/jquery.tablesorter.pager.js');
$this->headScript()->appendFile($this->basePath() . '/js/datatable.js');
?>
<header id="jumbotron-header">
    <div class="container">
        <h1><?php echo $this->escapeHtml($title); ?></h1>
    </div>
</header>
<?php $this->placeholder('header')->captureEnd(); ?>

<div id="search_hidden" class="row-fluid">
    <div class="input-append span4">
        <input id="search_hidden" placeholder="<?php echo $this->translate('Search for quiz'); ?>" type="text" class="span10">
        <button type="submit" class="btn"><i class="icon-search"></i></button>
    </div>
</div>

<table id="table_lists" class="table">
    <thead>
        <tr>
            <th></th>
            <th><?php echo $this->translate('Tags'); ?></th>
            <th><?php echo $this->translate('Rating'); ?></th>
            <th><?php echo $this->translate('Level'); ?></th>
            <th><?php echo $this->translate('Title'); ?></th>
            <th><?php echo $this->translate('Date'); ?></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
<?php foreach ($this->lists as $list) : $commentArea = 'comments-list-'.$list->id; ?>
      <tr class="listquest">
            <td>
<?php if ($this->zfcUserIdentity() && ($this->zfcUserIdentity()->getRoles()[0]->getRoleId() === 'teacher')) :?>             
                <button class="btn btn-mini btn-info " data-toggle="collapse" data-target="#<?php echo $commentArea; ?>" title="<?php echo $this->translate('See comments'); ?>">
                    <i class="icon-chevron-down icon-white"></i>
                </button>
<?php endif; ?>
<?php if ($this->zfcUserIdentity() && ($list->author->getId() === $this->zfcUserIdentity()->getId())) :?> 
                <div class="btn-group">
                    <a class="btn btn-primary btn-small" href="<?php echo $this->url('question',['action' => 'add','id' => $list->id]); ?>" title="<?php echo $this->translate('Add question'); ?>"><i class="icon-plus icon-white"></i></a>
                    <a class="btn btn-primary btn-small" href="<?php echo $this->url('list',['action' => 'show','id' => $list->id]); ?>" title="<?php echo $this->translate('Edit list'); ?>"><i class="icon-edit icon-white"></i></a>
                </div>
<?php endif; ?>
            </td>
            <td><?php if (count($list->tags) > 0) : echo $this->escapeHtml(implode(', ',$list->tags->toArray())); endif; ?></td>
            <td>
                <?php if (isset($ratingService)) : echo round($ratingService->getRatingSet($list->id)->getAmount());endif; ?>
            </td>
            <td><?php echo $this->escapeHtml($list->level); ?></td>        
            <td>
                <a href="<?php echo $this->url('question',['id' => $list->id]); ?>"><?php echo $this->escapeHtml($list->title); ?></a> 
                (<?php $nbQuestion = count($list->questions); echo $nbQuestion.' '.$this->translatePlural('question','questions',$nbQuestion);?>)
                <p>
<?php echo sprintf($this->translate('by %s'),
    ' '.$this->gravatar($list->author->getEmail(),['img_size' => '20px']).' '.$this->zfcUserDisplayName($list->author)
    .' ('.$list->author->getRoles()[0]->getRoleId(). '), '); ?>
                </p>
            </td>
            <td>            
<?php if ($this->zfcUserIdentity()) : ?><?php if ($ratingService->getMapper()->hasRated($this->zfcUserIdentity()->getId(),$list->id)) : ?>
            <a class="btn btn-mini" disabled><i class="icon-thumbs-up"></i> <?php echo $this->translate('Like');?></a> <?php echo $this->translate('I like this');?></a>
<?php else : ?>
            <a class="btn btn-mini" href="<?php echo $this->url('list',['action' => 'rate','id' => $list->id]); ?>"><i class="icon-thumbs-up"></i> <?php echo $this->translate('Like');?></a>    
<?php endif;?><?php endif;?>
            </td> 
            <td>
                <?php echo $this->dateFormat($list->creationDate,IntlDateFormatter::MEDIUM); ?>
            </td>
        </tr>
      
<?php if ($this->zfcUserIdentity() && ($this->zfcUserIdentity()->getRoles()[0]->getRoleId() === 'teacher')) :?>
        <div id="<?php echo $commentArea; ?>" class="collapse"> In test </div>        
<?php endif;?>      
<?php endforeach; ?>
    </tbody>
</table>
 

